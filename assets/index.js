/* ====================== TOOLS DATA ====================== */
const TOOLS_DATA = [
  {category:"Music & Social",tools:[
    {key:"bandlab",name:"TrackSniffer (BandLab)",desc:"Extract BandLab profile metadata.",code:`javascript:(function(){const u=window.location.href.split('/').pop();if(!u){alert('No username');return}fetch('https://www.bandlab.com/api/v1.3/users/'+u).then(r=>r.json()).then(d=>{const m=document.createElement('div');m.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#333;color:#fff;padding:20px;border:2px solid #fff;border-radius:10px;z-index:10000;max-width:80%;font-family:sans-serif;cursor:move;';let html='<h3>BandLab Info</h3>';html+='<p><b>User:</b> '+d.name+'</p>';html+='<p><b>ID:</b> '+d.id+'</p>';if(d.links){html+='<p><b>Links:</b></p><ul>';for(let[k,v]of Object.entries(d.links)){html+='<li>'+k+': <a href="'+v+'" target="_blank">'+v+'</a></li>';}html+='</ul>';}m.innerHTML=html;let close=document.createElement('button');close.textContent='×';close.style.cssText='position:absolute;top:5px;right:10px;background:none;border:none;color:#fff;font-size:28px;cursor:pointer;';close.onclick=()=>{document.body.removeChild(m);document.onmousemove=null;document.onmouseup=null;};m.appendChild(close);let drag={down:false,x:0,y:0};m.onmousedown=e=>{if(e.target.tagName==='A')return;drag.down=true;drag.x=e.clientX-m.offsetLeft;drag.y=e.clientY-m.offsetTop;};document.onmousemove=e=>{if(drag.down){m.style.left=e.clientX-drag.x+'px';m.style.top=e.clientY-drag.y+'px';}};document.onmouseup=()=>{drag.down=false;};document.body.appendChild(m);}).catch(e=>alert('Error'))})();`},
    {key:"smule",name:"SingSeeker (Smule)",desc:"Pull public Smule profile data.",code:`javascript:(function(){let u=window.location.pathname.split('/').pop();fetch('https://www.smule.com/api/profile/?handle='+u).then(r=>r.json()).then(d=>{let m=document.createElement('div');m.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#333;color:#fff;padding:20px;border:2px solid #fff;border-radius:10px;z-index:10000;max-width:80%;font-family:sans-serif;cursor:move;';let h='<h3>Smule Profile</h3>';h+='<p><b>Handle:</b> '+d.handle+'</p>';h+='<p><b>Name:</b> '+d.first_name+' '+d.last_name+'</p>';h+='<p><b>Location:</b> '+(d.location||'—')+'</p>';m.innerHTML=h;let c=document.createElement('button');c.textContent='×';c.style.cssText='position:absolute;top:5px;right:10px;background:none;border:none;color:#fff;font-size:28px;cursor:pointer;';c.onclick=()=>{document.body.removeChild(m);};m.appendChild(c);document.body.appendChild(m);});})();`}
  ]},
  {category:"Facebook Tools",tools:[
    {key:"fbtoolkit",name:"FaceToolkit (Facebook)",desc:"Grab ID, name, picture, search & marketplace helpers.",code:`javascript:(function(){let html=document.documentElement.outerHTML;let uid=(html.match(/"userID":"(\\d+)"/)||[])[1]||(html.match(/"entity_id":"(\\d+)"/)||[])[1];let name=(html.match(/"__isProfile":"User","name":"([^"]+)"/)||[])[1]||document.querySelector('meta[property="og:title"]').content;let pic;try{let s=document.querySelectorAll('script');for(let t of s){let j=JSON.parse(t.textContent);let f=function(o){if(o&&o.profilePicLarge&&o.profilePicLarge.uri)return o.profilePicLarge.uri;for(let k in o){let r=f(o[k]);if(r)return r}return null};pic=f(j);if(pic)break}}catch{}}let m=document.createElement('div');m.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#111;color:#fff;padding:20px;border:2px solid #1877f2;border-radius:12px;z-index:99999;width:360px;font-family:sans-serif;cursor:move;';m.innerHTML='<button id="fbClose" style="position:absolute;top:5px;right:10px;background:none;border:none;color:#fff;font-size:24px;cursor:pointer;">×</button><h3 style="margin:0;text-align:center;color:#1877f2;">Facebook Toolkit</h3><hr style="border:1px solid #1877f2;opacity:.4;margin:10px 0;"><p><b>Name:</b> '+name+'</p><p><b>ID:</b> '+(uid||'—')+'</p>'+(pic?'<p><b>Pic:</b> <a href="'+pic+'" target="_blank" style="color:#9cf;">Open</a></p>':'')+'<div style="margin-top:10px;text-align:center;"><button id="fbSearch" style="background:#1877f2;color:#fff;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;">Search</button><button id="fbMarket" style="margin-left:5px;background:#42b72a;color:#fff;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;">Marketplace</button><button id="fbCopy" style="margin-left:5px;background:#f7b928;color:#fff;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;">Copy</button></div>';document.body.appendChild(m);document.getElementById('fbClose').onclick=()=>{m.remove();};document.getElementById('fbCopy').onclick=()=>{navigator.clipboard.writeText('Name: '+name+'\\nID: '+(uid||'—'));alert('Copied');};document.getElementById('fbSearch').onclick=()=>{let q=prompt('Keyword');if(q)window.open('https://facebook.com/profile/'+uid+'/search/?q='+encodeURIComponent(q));};document.getElementById('fbMarket').onclick=()=>{window.open('https://www.facebook.com/marketplace/?seller_profile='+uid);};let drag={down:false,x:0,y:0};m.onmousedown=e=>{if(e.target.tagName==='BUTTON')return;drag.down=true;drag.x=e.clientX-m.offsetLeft;drag.y=e.clientY-m.offsetTop;};document.onmousemove=e=>{if(drag.down){m.style.left=e.clientX-drag.x+'px';m.style.top=e.clientY-drag.y+'px';}};document.onmouseup=()=>{drag.down=false;};})();`}
  ]},
  {category:"WordPress Tools",tools:[
    {key:"wposint",name:"WP OSINT Recon",desc:"Detect WP, list themes/plugins, sample REST, user-list warning.",code:"javascript:(async()=>{const CFG={SAMPLE:5,TIMEOUT:7000};const showStandby=()=>{let s=document.createElement('div');s.id='wpStandbyModal';s.style.cssText='position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:9998;background:#333;color:#fff;padding:12px 18px;border-radius:8px;font-family:sans-serif;font-size:14px;box-shadow:0 0 10px rgba(0,0,0,0.6);';s.innerText='Checking site... Please standby';document.body.appendChild(s);};const hideStandby=()=>{let s=document.getElementById('wpStandbyModal');s&&s.remove();};const showUserWarning=(baseURL)=>{let d=document.createElement('div');d.id='wpUserWarningModal';d.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10000;background:#222;color:#fff;padding:20px;border:2px solid #900;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.8);width:360px;font-family:sans-serif;';d.innerHTML='<div style=\"font-size:16px;font-weight:bold;margin-bottom:10px;\">Warning</div><div style=\"font-size:14px;margin-bottom:20px;\">Viewing User Accounts may expose your IP address to the site administrators.</div><div style=\"text-align:right;\"><button id=\"proceedUserAccounts\" style=\"margin-right:10px;background:#4caf50;color:#fff;border:none;padding:6px 10px;border-radius:4px;cursor:pointer;\">Proceed</button><button id=\"cancelUserAccounts\" style=\"background:#f44336;color:#fff;border:none;padding:6px 10px;border-radius:4px;cursor:pointer;\">Cancel</button></div>';document.body.appendChild(d);document.getElementById('cancelUserAccounts').onclick=()=>{d.remove();};document.getElementById('proceedUserAccounts').onclick=()=>{window.open(baseURL+'/wp-json/wp/v2/users','_blank');d.remove();};};showStandby();const origin=location.origin,html=document.documentElement.innerHTML;const checks=[];const inHtml=r=>new RegExp(r,'i').test(html);checks.push({label:'/wp-content/ in HTML',status:inHtml('\\/wp-content\\/')?'pass':'fail'});checks.push({label:'/wp-includes/ in HTML',status:inHtml('\\/wp-includes\\/')?'pass':'fail'});checks.push({label:'wp- scripts/styles',status:inHtml('\\bwp-(?:embed|emoji|json|includes)\\b')?'pass':'fail'});const gen=document.querySelector('meta[name=\"generator\"]');checks.push({label:'meta generator says WordPress',status:gen&&/wordpress/i.test(gen.content)?'pass':'fail'});const bodyCls=[...document.body.classList].filter(c=>/^wp-?/i.test(c)||/^(home|blog|page|archive)$/i.test(c));checks.push({label:'Body classes suggest WordPress',status:bodyCls.length?'pass':'fail'});const cookies=document.cookie.split(';').map(e=>e.trim()).filter(e=>/^wordpress_|^wp-|^wp-settings-|^wp_/i.test(e));checks.push({label:'Cookies suggest WordPress',status:cookies.length?'pass':'fail'});const head=async u=>{try{const r=await fetch(u,{method:'HEAD',signal:AbortSignal.timeout(CFG.TIMEOUT)});return r.ok?'pass':'fail'}catch{return'na'}};const get=async u=>{try{const r=await fetch(u,{signal:AbortSignal.timeout(CFG.TIMEOUT)});return r.ok?'pass':'fail'}catch{return'na'}};const l=origin;checks.push({label:'/wp-login.php',status:await head(l+'/wp-login.php')});checks.push({label:'/wp-admin/',status:await head(l+'/wp-admin/')});checks.push({label:'/wp-json/ (REST API)',status:await get(l+'/wp-json/')});checks.push({label:'/xmlrpc.php',status:await head(l+'/xmlrpc.php')});checks.push({label:'/readme.html',status:await head(l+'/readme.html')});checks.forEach(e=>{'pass'===e.status&&(checks.score=checks.score+1||1)});const d=checks.score>=7?'LIKELY WordPress':checks.score>=4?'POSSIBLY WordPress':'UNLIKELY WordPress';hideStandby();let m=document.createElement('div');m.innerHTML='<div id=\"wpDetectModal\" style=\"position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:9999;background:#222;color:#fff;padding:20px;border:2px solid #555;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.8);width:360px;font-family:sans-serif;\"><div style=\"font-size:18px;margin-bottom:8px;font-weight:bold;\">WordPress Detection</div><div style=\"margin-bottom:10px;\"><strong>Verdict:</strong> <span style=\"color:'+(d==='LIKELY WordPress'?'limegreen':d==='POSSIBLY WordPress'?'orange':'orangered')+'\">'+d+'</span><br><strong>Score:</strong> '+checks.score+'</div><div><strong>Checks:</strong><ul style=\"padding-left:18px;margin:0 0 0 10px;font-size:13px;list-style:none;\">'+checks.map(e=>'<li style=\"margin-bottom:4px;\"><span style=\"color:'+(e.status==='pass'?'limegreen':e.status==='fail'?'orangered':'gray')+';font-weight:bold;\">'+(e.status==='pass'?'PASS':e.status==='fail'?'FAIL':'UNKNOWN')+'</span> '+e.label+'</li>').join('')+'</ul></div><div style=\"text-align:right;margin-top:10px;\"><button id=\"wpDetectClose\" style=\"background:#444;color:#fff;border:none;padding:6px 10px;border-radius:4px;margin-right:10px;cursor:pointer;\">Close</button><button id=\"wpListUsers\" style=\"background:#21759b;color:#fff;border:none;padding:6px 10px;border-radius:4px;cursor:pointer;\">List User Accounts</button></div></div>';document.body.appendChild(m);document.getElementById('wpDetectClose').onclick=()=>{document.getElementById('wpDetectModal').remove();};document.getElementById('wpListUsers').onclick=()=>{showUserWarning(l);};})();"}
  ]},
  {category:"General Utilities",tools:[
    {key:"blurbuster",name:"BlurBuster",desc:"Remove blur/paywall effects.",code:`javascript:(function(){const k=['blur','frost','masked','obscured'];k.forEach(w=>{document.querySelectorAll(\`[class*="\${w}"]\`).forEach(e=>{e.className=e.className.split(' ').filter(c=>!c.toLowerCase().includes(w)).join(' ');});});document.querySelectorAll('*').forEach(e=>{let s=window.getComputedStyle(e);if(s.filter.includes('blur'))e.style.filter='none';if(s.backdropFilter.includes('blur'))e.style.backdropFilter='none';});document.querySelectorAll('[style]').forEach(e=>{let s=e.getAttribute('style');if(/blur|frost/i.test(s))e.setAttribute('style',s.replace(/filter\\s*:\\s*blur\\([^)]+\\)/gi,'').replace(/backdrop-filter\\s*:\\s*blur\\([^)]+\\)/gi,'').trim());});alert('Blur removed');})();`},
    {key:"jsonfinder",name:"JSON Script Finder",desc:"Show all JSON in <script> tags.",code:`javascript:(function(){let s=document.querySelectorAll('script'),j=[];for(let i=0;i<s.length;i++){let t=s[i].textContent.trim();if(t[0]==='{'||t[0]==='[')try{j.push({i,data:JSON.parse(t)})}catch{}}if(!j.length){alert('No JSON');return;}let m=document.createElement('div');m.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#333;color:#fff;padding:20px;border:2px solid #fff;border-radius:10px;z-index:10000;max-width:80%;max-height:80%;overflow:auto;font-family:sans-serif;cursor:move;';let sel=document.createElement('select');sel.style.cssText='width:100%;padding:5px;margin-bottom:10px;background:#222;color:#fff;border:1px solid #fff;border-radius:5px;';j.forEach((o,k)=>{let opt=document.createElement('option');opt.value=k;opt.textContent='JSON #'+(k+1);sel.appendChild(opt);});let pre=document.createElement('pre');pre.style.cssText='white-space:pre-wrap;background:#222;padding:10px;border-radius:5px;overflow:auto;';pre.textContent=JSON.stringify(j[0].data,null,2);sel.onchange=()=>{pre.textContent=JSON.stringify(j[+sel.value].data,null,2);};let copy=document.createElement('button');copy.textContent='Copy';copy.style.cssText='margin-top:10px;padding:5px 10px;background:#444;color:#fff;border:1px solid #fff;border-radius:5px;cursor:pointer;';copy.onclick=()=>{navigator.clipboard.writeText(pre.textContent).then(()=>{copy.textContent='Copied!';setTimeout(()=>{copy.textContent='Copy'},1500);});};let close=document.createElement('button');close.textContent='×';close.style.cssText='position:absolute;top:5px;right:10px;background:none;border:none;color:#fff;font-size:28px;cursor:pointer;';close.onclick=()=>{document.body.removeChild(m);};m.appendChild(close);m.appendChild(document.createElement('h3')).textContent='JSON Scripts ('+j.length+')';m.appendChild(sel);m.appendChild(copy);m.appendChild(pre);document.body.appendChild(m);})();`}
  ]},
  {category:"TikTok Tools",tools:[
    {key:"tiktok",name:"TikTok Profile Extractor",desc:"Grab username, nickname, bio, followers, following, likes, verified.",code:`javascript:(function(){let u=window.location.pathname.split('/').filter(Boolean)[0].replace('@','');fetch('https://www.tiktok.com/api/user/detail/?uniqueId='+u).then(r=>r.json()).then(d=>{if(!d.userInfo)return alert('No data');let i=d.userInfo;let m=document.createElement('div');m.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#111;color:#fff;padding:20px;border:2px solid #ff0050;border-radius:12px;z-index:99999;max-width:80%;font-family:sans-serif;cursor:move;';m.innerHTML='<button id="ttClose" style="position:absolute;top:5px;right:10px;background:none;border:none;color:#fff;font-size:24px;cursor:pointer;">×</button><h3 style="margin:0;color:#ff0050;">TikTok Profile</h3><hr style="border-color:#ff0050;opacity:.4;margin:10px 0;"><p><b>Username:</b> @'+i.uniqueId+'</p><p><b>Nickname:</b> '+i.nickname+'</p><p><b>Bio:</b> '+ (i.signature||'—')+'</p><p><b>Followers:</b> '+i.stats.followerCount+'</p><p><b>Following:</b> '+i.stats.followingCount+'</p><p><b>Likes:</b> '+i.stats.heartCount+'</p><p><b>Verified:</b> '+ (i.verified?'Yes':'No')+'</p>';document.body.appendChild(m);document.getElementById('ttClose').onclick=()=>{m.remove();};let drag={down:false,x:0,y:0};m.onmousedown=e=>{if(e.target.tagName==='BUTTON')return;drag.down=true;drag.x=e.clientX-m.offsetLeft;drag.y=e.clientY-m.offsetTop;};document.onmousemove=e=>{if(drag.down){m.style.left=e.clientX-drag.x+'px';m.style.top=e.clientY-drag.y+'px';}};document.onmouseup=()=>{drag.down=false;};}).catch(e=>alert('Error'))})();`}
  ]},
  {category:"Instagram Tools",tools:[
    {key:"instagram",name:"Instagram Profile Scraper",desc:"Username, full name, bio, followers, following, posts, external URL.",code:`javascript:(function(){let u=window.location.pathname.split('/')[1];if(!u){alert('Open a profile');return}fetch('https://www.instagram.com/'+u+'/?__a=1&__d=dis').then(r=>r.json()).then(d=>{let i=d.graphql.user;let m=document.createElement('div');m.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#111;color:#fff;padding:20px;border:2px solid #e1306c;border-radius:12px;z-index:99999;max-width:80%;font-family:sans-serif;cursor:move;';m.innerHTML='<button id="igClose" style="position:absolute;top:5px;right:10px;background:none;border:none;color:#fff;font-size:24px;cursor:pointer;">×</button><h3 style="margin:0;color:#e1306c;">Instagram Profile</h3><hr style="border-color:#e1306c;opacity:.4;margin:10px 0;"><p><b>Username:</b> '+i.username+'</p><p><b>Full Name:</b> '+ (i.full_name||'—')+'</p><p><b>Bio:</b> '+ (i.biography||'—')+'</p><p><b>Followers:</b> '+i.edge_followed_by.count+'</p><p><b>Following:</b> '+i.edge_follow.count+'</p><p><b>Posts:</b> '+i.edge_owner_to_timeline_media.count+'</p>'+(i.external_url?'<p><b>Link:</b> <a href="'+i.external_url+'" target="_blank" style="color:#9cf;">'+i.external_url+'</a></p>':'');document.body.appendChild(m);document.getElementById('igClose').onclick=()=>{m.remove();};let drag={down:false,x:0,y:0};m.onmousedown=e=>{if(e.target.tagName==='BUTTON')return;drag.down=true;drag.x=e.clientX-m.offsetLeft;drag.y=e.clientY-m.offsetTop;};document.onmousemove=e=>{if(drag.down){m.style.left=e.clientX-drag.x+'px';m.style.top=e.clientY-drag.y+'px';}};document.onmouseup=()=>{drag.down=false;};}).catch(e=>alert('Error – try logged-in or public profile'))})();`}
  ]},
  {category:"Twitter / X Tools",tools:[
    {key:"twitter",name:"Twitter Profile Extractor",desc:"Username, name, bio, location, followers, following, joined date.",code:`javascript:(function(){let u=window.location.pathname.split('/')[1];if(!u){alert('Open a profile');return}fetch('https://twitter.com/i/api/graphql/7jT5pLHbG9Z4tP7U5eV3GQ/UserByScreenName?variables='+encodeURIComponent(JSON.stringify({screen_name:u,withSafetyModeUserFields:true}))).then(r=>r.json()).then(d=>{let i=d.data.user.result;let m=document.createElement('div');m.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#111;color:#fff;padding:20px;border:2px solid #1da1f2;border-radius:12px;z-index:99999;max-width:80%;font-family:sans-serif;cursor:move;';m.innerHTML='<button id="twClose" style="position:absolute;top:5px;right:10px;background:none;border:none;color:#fff;font-size:24px;cursor:pointer;">×</button><h3 style="margin:0;color:#1da1f2;">Twitter Profile</h3><hr style="border-color:#1da1f2;opacity:.4;margin:10px 0;"><p><b>Username:</b> @'+i.legacy.screen_name+'</p><p><b>Name:</b> '+i.legacy.name+'</p><p><b>Bio:</b> '+ (i.legacy.description||'—')+'</p><p><b>Location:</b> '+ (i.legacy.location||'—')+'</p><p><b>Followers:</b> '+i.legacy.followers_count+'</p><p><b>Following:</b> '+i.legacy.friends_count+'</p><p><b>Joined:</b> '+new Date(i.legacy.created_at).toLocaleDateString()+'</p>';document.body.appendChild(m);document.getElementById('twClose').onclick=()=>{m.remove();};let drag={down:false,x:0,y:0};m.onmousedown=e=>{if(e.target.tagName==='BUTTON')return;drag.down=true;drag.x=e.clientX-m.offsetLeft;drag.y=e.clientY-m.offsetTop;};document.onmousemove=e=>{if(drag.down){m.style.left=e.clientX-drag.x+'px';m.style.top=e.clientY-drag.y+'px';}};document.onmouseup=()=>{drag.down=false;};}).catch(e=>alert('Error – may need login'))})();`}
  ]}
];

/* ====================== HELPERS ====================== */
const U = {
  esc(s) {
    return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
  },
  bm(code) {
    let c = code.trim();
    if (!c.startsWith('javascript:')) c = 'javascript:' + c;
    return encodeURI(c);
  },
  download(name, content, type = 'application/javascript') {
    const b = new Blob([content], {type});
    const u = URL.createObjectURL(b);
    const a = document.createElement('a');
    a.href = u;
    a.download = name;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(u);
  },
  copy(t) {
    return navigator.clipboard.writeText(t);
  }
};
/* ====================== DOM BUILD ====================== */
const DB = {
  card(t){const c=document.createElement('div');c.className='tool-card';c.dataset.key=t.key;c.innerHTML=`
    <div class="tool-name">${t.name}</div>
    <div class="tool-desc">${t.desc}</div>
    <div class="drag-row"><a class="drag-btn" href="${U.bm(t.code)}" draggable="true" title="Drag to bookmarks">Drag ${t.name.split('(')[0].trim()}</a></div>
  `;return c;},
  group(cat,tools){const g=document.createElement('div');g.className='tool-group';const h=document.createElement('h3');h.textContent=cat;g.appendChild(h);tools.forEach(t=>g.appendChild(this.card(t)));return g;},
  render(){const c=document.getElementById('toolsList');c.innerHTML='';TOOLS_DATA.forEach(s=>c.appendChild(this.group(s.category,s.tools)));},
  show(t){const a=document.getElementById('toolArea');a.innerHTML=`
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
      <div><h3 style="margin:0">${t.name}</h3><div class="small" style="margin-top:6px;color:var(--muted)">${t.desc}</div></div>
      <div><a class="drag-btn" href="${U.bm(t.code)}" draggable="true">Drag ${t.name.split('(')[0].trim()}</a></div>
    </div>
    <div class="code-actions">
      <button id="edit">Edit</button>
      <button id="savejs">Save as .js</button>
      <button class="ghost" id="copy">Copy Code</button>
    </div>
    <div id="codeView"><pre class="code-block"><code id="codeBlock" class="language-javascript">${U.esc(t.code)}</code></pre></div>
    <div id="editView" style="display:none">
      <textarea id="editor">${t.code}</textarea>
      <div style="margin-top:10px">
        <button id="saveEdit">Save & Download</button>
        <button class="ghost" id="cancelEdit">Cancel</button>
      </div>
    </div>
  `;Prism&&Prism.highlightElement(document.getElementById('codeBlock'));this.bind(t);}
  ,bind(t){
    document.getElementById('edit').onclick=()=>{document.getElementById('editView').style.display='block';document.getElementById('codeView').style.display='none';};
    document.getElementById('cancelEdit').onclick=()=>{document.getElementById('editView').style.display='none';document.getElementById('codeView').style.display='block';};
    document.getElementById('copy').onclick=()=>{U.copy(t.code).then(()=>{alert('Copied!')}).catch(()=>{alert('Copy failed')});};
    document.getElementById('savejs').onclick=()=>{U.download(t.key+'.js',t.code);};
    document.getElementById('saveEdit').onclick=()=>{U.download(t.key+'-edited.js',document.getElementById('editor').value);};
  }
};

/* ====================== SEARCH ====================== */
const Search = {
  all:[],
  init(d){this.all=d.flatMap(s=>s.tools.map(t=>({...t,cat:s.category})));},
  filter(q){
    q=q.toLowerCase().trim();if(!q){document.querySelectorAll('.tool-card,.tool-group').forEach(e=>e.style.display='');return;}
    document.querySelectorAll('.tool-card').forEach(c=>{const k=c.dataset.key;const t=this.all.find(x=>x.key===k);const match=t.name.toLowerCase().includes(q)||t.desc.toLowerCase().includes(q)||t.key.toLowerCase().includes(q)||t.cat.toLowerCase().includes(q);c.style.display=match?'':'none';});
    document.querySelectorAll('.tool-group').forEach(g=>{g.style.display=g.querySelectorAll('.tool-card[style=""]').length?'':'none';});
  }
};

/* ====================== INIT ====================== */
function init(){
  DB.render();Search.init(TOOLS_DATA);
  document.getElementById('search').oninput=e=>Search.filter(e.target.value);
  document.querySelectorAll('.tool-card').forEach(c=>c.onclick=e=>{if(e.target.tagName==='A')return;const t=Search.all.find(x=>x.key===c.dataset.key);t&&DB.show(t);});
  Search.all.length&&DB.show(Search.all[0]);
}
document.readyState==='loading'?document.addEventListener('DOMContentLoaded',init):init();
